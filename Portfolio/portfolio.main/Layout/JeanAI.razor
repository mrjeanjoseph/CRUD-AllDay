@inherits LayoutComponentBase

<div class="jeanai-container">
    @if (!isOpen)
    {
        <div class="jeanai-actions d-flex gap-2">
            <button class="jeanai-trigger btn btn-primary" @onclick="ToggleChat" aria-label="Open JeanAI">
                <i class="bi bi-chat-dots"></i>
                <span class="ms-1 d-none d-md-inline">JeanAI</span>
            </button>
            <button type="button" class="back-to-top-square btn btn-outline-primary" aria-label="Back to top"
                @onclick="BackToTop">
                <i class="bi bi-arrow-up"></i>
            </button>
        </div>
    }

    @if (isOpen)
    {
        <div class="jeanai-backdrop" @onclick="CloseChat"></div>
        <div class="jeanai-panel shadow" @onclick="PanelClicked" @onclick:stopPropagation>
            <div class="jeanai-header d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-robot"></i>
                    <strong>JeanAI</strong>
                </div>
                <button class="btn btn-sm btn-outline-secondary" @onclick="ToggleChat" aria-label="Close">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="jeanai-body">
                <div class="message-row system">
                    <div class="message">Hi there! Coming soon ðŸ‘‹</div>
                </div>
                <div class="message-row user">
                    <div class="message">Can you help with my portfolio?</div>
                </div>
                <div class="message-row system">
                    <div class="message">Absolutely. Features will arrive shortly.</div>
                </div>
            </div>
            <div class="jeanai-footer">
                <input class="form-control" placeholder="Type a message (disabled)" disabled />
            </div>
        </div>
    }
</div>

@code {
    [Inject] private IJSRuntime JSRuntime { get; set; } = default!;

    private bool isOpen = false;

    private void ToggleChat()
    {
        isOpen = !isOpen;
    }

    private void CloseChat()
    {
        isOpen = false;
    }

    private async Task BackToTop()
    {
        await JSRuntime.InvokeVoidAsync("window.scrollTo", 0, 0);
    }

    private void PanelClicked()
    {
        // Intentionally empty; used with @onclick:stopPropagation to prevent backdrop close
    }
}